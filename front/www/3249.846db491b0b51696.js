"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3249],{3249:(C,c,s)=>{s.r(c),s.d(c,{UsuarioComumPageModule:()=>k});var p=s(2200),a=s(4341),i=s(9420),h=s(8132),d=s(467),e=s(3664),m=s(8728),f=s(9330);let g=(()=>{class t{constructor(o){this.http=o,this.apiUrl="http://localhost:8080/api/v1/usuario"}getMyData(){return this.http.get(`${this.apiUrl}/me`)}updateProfile(o){return this.http.put(`${this.apiUrl}/me/update-profile`,o)}changePassword(o){return this.http.put(`${this.apiUrl}/me/change-password`,o)}static#e=this.\u0275fac=function(r){return new(r||t)(m.KVO(f.Qq))};static#o=this.\u0275prov=m.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();const v=[{path:"",component:(()=>{class t{constructor(o,r,n){this.formBuilder=o,this.toastController=r,this.usuarioService=n,this.formGroup=this.formBuilder.group({nome:["",a.k0.required],email:[{value:"",disabled:!0}],senha:["",a.k0.compose([a.k0.required,a.k0.minLength(8)])],senhaNova:["",a.k0.compose([a.k0.required,a.k0.minLength(8)])]})}ngOnInit(){this.loadUserData()}loadUserData(){this.usuarioService.getMyData().subscribe({next:o=>{this.formGroup.patchValue({email:o.login,nome:o.nome})},error:o=>{this.exibirMensagem("Erro ao carregar os dados do usu\xe1rio."),console.error(o)}})}updateProfile(){if(this.formGroup.get("nome")?.invalid)return void this.exibirMensagem("O nome \xe9 obrigat\xf3rio.");const o=this.formGroup.get("nome")?.value;this.usuarioService.updateProfile({nome:o}).subscribe({next:()=>{this.exibirMensagem("Perfil atualizado com sucesso!")},error:r=>{this.exibirMensagem("Erro ao atualizar o perfil."),console.error(r)}})}changePassword(){const o=this.formGroup.get("senha"),r=this.formGroup.get("senhaNova");o?.invalid||r?.invalid?this.exibirMensagem("As senhas devem ter no m\xednimo 8 caracteres."):this.usuarioService.changePassword({senhaAntiga:o?.value,novaSenha:r?.value}).subscribe({next:()=>{this.exibirMensagem("Senha alterada com sucesso!"),o?.reset(),r?.reset()},error:l=>{this.exibirMensagem(l.error?.message||"Erro ao alterar a senha. Tente novamente."),console.error(l)}})}exibirMensagem(o){var r=this;return(0,d.A)(function*(){(yield r.toastController.create({message:o,duration:2e3,position:"top"})).present()})()}static#e=this.\u0275fac=function(r){return new(r||t)(e.rXU(a.ok),e.rXU(i.K_),e.rXU(g))};static#o=this.\u0275cmp=e.VBU({type:t,selectors:[["app-usuario-comum"]],standalone:!1,decls:32,vars:3,consts:[["color","transparent"],[1,"ion-padding"],[1,"perfil-form",3,"formGroup"],[1,"form-item"],["position","stacked"],["type","text","placeholder","Digite seu nome","formControlName","nome",1,"form-input"],["type","email","formControlName","email","readonly","",1,"form-input"],[1,"form-buttons"],["expand","block",1,"botao",3,"click","disabled"],["name","save-outline","slot","start"],["type","password","placeholder","Digite a senha antiga","formControlName","senha",1,"form-input"],["type","password","placeholder","Digite a nova senha","formControlName","senhaNova",1,"form-input"],["name","lock-closed-outline","slot","start"]],template:function(r,n){if(1&r&&(e.nrm(0,"ion-toolbar",0),e.j41(1,"ion-content",1)(2,"form",2)(3,"ion-list-header")(4,"ion-label"),e.EFF(5,"Dados do Perfil"),e.k0s()(),e.j41(6,"ion-item",3)(7,"ion-label",4),e.EFF(8,"Nome"),e.k0s(),e.nrm(9,"ion-input",5),e.k0s(),e.j41(10,"ion-item",3)(11,"ion-label",4),e.EFF(12,"Email"),e.k0s(),e.nrm(13,"ion-input",6),e.k0s(),e.j41(14,"div",7)(15,"ion-button",8),e.bIt("click",function(){return n.updateProfile()}),e.nrm(16,"ion-icon",9),e.EFF(17," Atualizar Nome "),e.k0s()(),e.j41(18,"ion-list-header")(19,"ion-label"),e.EFF(20,"Alterar Senha"),e.k0s()(),e.j41(21,"ion-item",3)(22,"ion-label",4),e.EFF(23,"Senha Antiga"),e.k0s(),e.nrm(24,"ion-input",10),e.k0s(),e.j41(25,"ion-item",3)(26,"ion-label",4),e.EFF(27,"Nova Senha"),e.k0s(),e.nrm(28,"ion-input",11),e.k0s(),e.j41(29,"ion-button",8),e.bIt("click",function(){return n.changePassword()}),e.nrm(30,"ion-icon",12),e.EFF(31," Alterar Senha "),e.k0s()()()),2&r){let l,u;e.R7$(2),e.Y8G("formGroup",n.formGroup),e.R7$(13),e.Y8G("disabled",null==(l=n.formGroup.get("nome"))?null:l.invalid),e.R7$(14),e.Y8G("disabled",(null==(u=n.formGroup.get("senha"))?null:u.invalid)||(null==(u=n.formGroup.get("senhaNova"))?null:u.invalid))}},dependencies:[a.qT,a.BC,a.cb,a.j4,a.JD,i.Jm,i.W9,i.iq,i.$w,i.uz,i.he,i.AF,i.ai,i.Gw],encapsulation:2})}return t})()}];let b=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#o=this.\u0275mod=e.$C({type:t});static#t=this.\u0275inj=m.G2t({imports:[h.iI.forChild(v),h.iI]})}return t})(),k=(()=>{class t{static#e=this.\u0275fac=function(r){return new(r||t)};static#o=this.\u0275mod=e.$C({type:t});static#t=this.\u0275inj=m.G2t({imports:[p.MD,a.YN,a.X1,i.bv,b]})}return t})()}}]);