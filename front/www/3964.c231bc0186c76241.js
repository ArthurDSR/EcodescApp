"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3964],{3964:(_,P,c)=>{c.r(P),c.d(P,{AddNovidadePageModule:()=>k});var x=c(2200),p=c(4341),m=c(9420),y=c(8132),u=c(467),C=c(3643),v=c(5083),g=function(r){return r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS",r}(g||{}),b=function(r){return r.Rear="REAR",r.Front="FRONT",r}(b||{});class w extends v.E_{getPhoto(a){var n=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(i,o){if(a.webUseInput||a.source===g.Photos)n.fileInputExperience(a,i,o);else if(a.source===g.Prompt){let s=document.querySelector("pwa-action-sheet");s||(s=document.createElement("pwa-action-sheet"),document.body.appendChild(s)),s.header=a.promptLabelHeader||"Photo",s.cancelable=!1,s.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],s.addEventListener("onSelection",function(){var l=(0,u.A)(function*(d){0===d.detail?n.fileInputExperience(a,i,o):n.cameraExperience(a,i,o)});return function(d){return l.apply(this,arguments)}}())}else n.cameraExperience(a,i,o)});return function(i,o){return e.apply(this,arguments)}}())})()}pickImages(a){var n=this;return(0,u.A)(function*(){return new Promise(function(){var e=(0,u.A)(function*(i,o){n.multipleFileInputExperience(i,o)});return function(i,o){return e.apply(this,arguments)}}())})()}cameraExperience(a,n,e){var i=this;return(0,u.A)(function*(){if(customElements.get("pwa-camera-modal")){const o=document.createElement("pwa-camera-modal");o.facingMode=a.direction===b.Front?"user":"environment",document.body.appendChild(o);try{yield o.componentOnReady(),o.addEventListener("onPhoto",function(){var s=(0,u.A)(function*(l){const d=l.detail;null===d?e(new v.I9("User cancelled photos app")):d instanceof Error?e(d):n(yield i._getCameraPhoto(d,a)),o.dismiss(),document.body.removeChild(o)});return function(l){return s.apply(this,arguments)}}()),o.present()}catch{i.fileInputExperience(a,n,e)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),i.fileInputExperience(a,n,e)})()}fileInputExperience(a,n,e){let i=document.querySelector("#_capacitor-camera-input");const o=()=>{var s;null===(s=i.parentNode)||void 0===s||s.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input",i.type="file",i.hidden=!0,document.body.appendChild(i),i.addEventListener("change",s=>{const l=i.files[0];let d="jpeg";if("image/png"===l.type?d="png":"image/gif"===l.type&&(d="gif"),"dataUrl"===a.resultType||"base64"===a.resultType){const h=new FileReader;h.addEventListener("load",()=>{if("dataUrl"===a.resultType)n({dataUrl:h.result,format:d});else if("base64"===a.resultType){const O=h.result.split(",")[1];n({base64String:O,format:d})}o()}),h.readAsDataURL(l)}else n({webPath:URL.createObjectURL(l),format:d}),o()}),i.addEventListener("cancel",s=>{e(new v.I9("User cancelled photos app")),o()})),i.accept="image/*",i.capture=!0,a.source===g.Photos||a.source===g.Prompt?i.removeAttribute("capture"):a.direction===b.Front?i.capture="user":a.direction===b.Rear&&(i.capture="environment"),i.click()}multipleFileInputExperience(a,n){let e=document.querySelector("#_capacitor-camera-input-multiple");const i=()=>{var o;null===(o=e.parentNode)||void 0===o||o.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input-multiple",e.type="file",e.hidden=!0,e.multiple=!0,document.body.appendChild(e),e.addEventListener("change",o=>{const s=[];for(let l=0;l<e.files.length;l++){const d=e.files[l];let h="jpeg";"image/png"===d.type?h="png":"image/gif"===d.type&&(h="gif"),s.push({webPath:URL.createObjectURL(d),format:h})}a({photos:s}),i()}),e.addEventListener("cancel",o=>{n(new v.I9("User cancelled photos app")),i()})),e.accept="image/*",e.click()}_getCameraPhoto(a,n){return new Promise((e,i)=>{const o=new FileReader,s=a.type.split("/")[1];"uri"===n.resultType?e({webPath:URL.createObjectURL(a),format:s,saved:!1}):(o.readAsDataURL(a),o.onloadend=()=>{const l=o.result;e("dataUrl"===n.resultType?{dataUrl:l,format:s,saved:!1}:{base64String:l.split(",")[1],format:s,saved:!1})},o.onerror=l=>{i(l)})})}checkPermissions(){var a=this;return(0,u.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw a.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw a.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var a=this;return(0,u.A)(function*(){throw a.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var a=this;return(0,u.A)(function*(){throw a.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var a=this;return(0,u.A)(function*(){throw a.unavailable("Not implemented on web.")})()}}new w;const U=(0,v.F3)("Camera",{web:()=>new w});var t=c(3664),f=c(8728),E=c(4192),N=c(5032),I=c(9330),M=c(4);function F(r,a){if(1&r&&t.nrm(0,"img",14),2&r){const n=t.XpG();t.Y8G("src",n.preview,t.B4B)}}function L(r,a){1&r&&(t.j41(0,"div",15),t.nrm(1,"ion-icon",16),t.j41(2,"span"),t.EFF(3,"Selecionar foto"),t.k0s()())}const j=[{path:"",component:(()=>{class r{constructor(n,e,i,o,s,l,d){this.router=n,this.formBuilder=e,this.toastController=i,this.activatedRoute=o,this.navController=s,this.http=l,this.novidadeService=d,this.preview=null,this.file=null,this.novidade=new C.l,this.formGroup=this.formBuilder.group({titulo:["",p.k0.compose([p.k0.required])],texto:["",p.k0.compose([p.k0.required])]})}ngOnInit(){let n=parseFloat(this.activatedRoute.snapshot.params.id);isNaN(n)||this.novidadeService.buscarPorId(n).subscribe({next:e=>{this.novidade=e,this.formGroup.patchValue({titulo:this.novidade.titulo,texto:this.novidade.texto}),this.novidade.imagemCaminho&&(this.preview=`http://localhost:8080/uploads/${this.novidade.imagemCaminho}`),console.log("Preview da imagem:",this.preview),console.log("Novidade carregada para edi\xe7\xe3o:",this.novidade)},error:e=>{console.error(e),this.exibirMensagem("Erro ao carregar a novidade.")}})}ngAfterViewInit(){this.preview=this.novidade.imagemCaminho}selecionarImagem(){var n=this;return(0,u.A)(function*(){try{const e=yield U.pickImages({limit:1,quality:90});if(e.photos.length>0){const i=e.photos[0];i.webPath&&(n.preview=i.webPath);const s=yield(yield fetch(i.webPath)).blob();let l=s.type.split("/")[1];l=l.replace("+xml",""),n.file=new File([s],`imagemSelecionada.${l}`,{type:s.type})}}catch(e){console.error("Erro ao selecionar imagem:",e)}})()}salvarNovidade(){if(this.formGroup.invalid)return void this.exibirMensagem("Por favor, preencha todos os campos obrigat\xf3rios.");const n=new FormData;n.append("titulo",this.formGroup.value.titulo),n.append("texto",this.formGroup.value.texto),this.file&&n.append("imagem",this.file),console.log("Enviando novidade com imagem...",n),this.novidade.id?(this.novidade.dataAlteracao=new Date,this.novidadeService.atualizarComImagem(this.novidade.id,n).subscribe({next:()=>{this.exibirMensagem("Novidade atualizada com sucesso!!!"),this.router.navigate(["/novidade"],{replaceUrl:!0})},error:e=>{console.error(e),this.exibirMensagem("Erro ao atualizar a novidade.")}})):this.novidadeService.salvarComImagem(n).subscribe({next:()=>{this.exibirMensagem("Novidade salva com sucesso!!!"),this.router.navigate(["/novidade"],{replaceUrl:!0})},error:e=>{console.error(e),this.exibirMensagem("Erro ao salvar a novidade.")}}),this.router.navigate(["/novidade"],{replaceUrl:!0})}limpar(){this.formGroup.reset(),this.preview=null}voltar(){this.router.navigate(["/novidade"],{replaceUrl:!0})}exibirMensagem(n){var e=this;return(0,u.A)(function*(){(yield e.toastController.create({message:n,duration:1500})).present()})()}static#e=this.\u0275fac=function(e){return new(e||r)(t.rXU(E.Ix),t.rXU(p.ok),t.rXU(m.K_),t.rXU(E.nX),t.rXU(N.q9),t.rXU(I.Qq),t.rXU(M.e))};static#t=this.\u0275cmp=t.VBU({type:r,selectors:[["app-add-novidade"]],standalone:!1,decls:24,vars:3,consts:[["placeholder",""],["color","transparent"],[1,"ion-padding"],[1,"novidade-form",3,"formGroup"],["expand","block",1,"botao",3,"click"],["name","refresh-outline","slot","start"],[1,"form-item"],["position","stacked"],["type","text","placeholder","Digite o t\xedtulo da novidade","formControlName","titulo",1,"form-input"],["placeholder","Digite o corpo da novidade","formControlName","texto","rows","18",1,"form-input"],[1,"profile-image-container",3,"click"],["class","profile-image",3,"src",4,"ngIf","ngIfElse"],[1,"form-buttons"],["name","save-outline","slot","start"],[1,"profile-image",3,"src"],[1,"placeholder"],["name","camera-outline"]],template:function(e,i){if(1&e){const o=t.RV6();t.nrm(0,"ion-toolbar",1),t.j41(1,"ion-content",2)(2,"form",3)(3,"ion-row")(4,"ion-col")(5,"ion-button",4),t.bIt("click",function(){return f.eBV(o),f.Njj(i.limpar())}),t.nrm(6,"ion-icon",5),t.EFF(7," Limpar "),t.k0s()()(),t.j41(8,"ion-item",6)(9,"ion-label",7),t.EFF(10,"T\xedtulo"),t.k0s(),t.nrm(11,"ion-input",8),t.k0s(),t.j41(12,"ion-item",6)(13,"ion-label",7),t.EFF(14,"Corpo da Novidade"),t.k0s(),t.nrm(15,"ion-textarea",9),t.k0s(),t.j41(16,"div",10),t.bIt("click",function(){return f.eBV(o),f.Njj(i.selecionarImagem())}),t.DNE(17,F,1,1,"img",11)(18,L,4,0,"ng-template",null,0,t.C5r),t.k0s(),t.j41(20,"div",12)(21,"ion-button",4),t.bIt("click",function(){return f.eBV(o),f.Njj(i.salvarNovidade())}),t.nrm(22,"ion-icon",13),t.EFF(23," Salvar Novidade "),t.k0s()()()()}if(2&e){const o=t.sdS(19);t.R7$(2),t.Y8G("formGroup",i.formGroup),t.R7$(15),t.Y8G("ngIf",i.preview)("ngIfElse",o)}},dependencies:[x.bT,p.qT,p.BC,p.cb,p.j4,p.JD,m.Jm,m.hU,m.W9,m.iq,m.$w,m.uz,m.he,m.ln,m.nc,m.ai,m.Gw],styles:[".img-input[_ngcontent-%COMP%]{font-size:12px;padding:8px 0}.img-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:250px;box-shadow:0}ion-card[_ngcontent-%COMP%]{box-shadow:none!important}.img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain}.profile-image-container[_ngcontent-%COMP%]{justify-self:center;width:240px;height:120px;border-radius:2%;overflow:hidden;border:2px dashed #ccc;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;transition:border-color .3s}.profile-image-container[_ngcontent-%COMP%]:hover{border-color:#666}.profile-image[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;color:#aaa;font-size:14px;text-align:center}.placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:5px}.form-item[_ngcontent-%COMP%]{color:#003554;margin-bottom:20px;--background: rgba(140, 190, 227, .15);--border-radius: 15px;--border-style: none;--inner-border-width: 0;border-radius:15px;padding:10px}"]})}return r})()}];let R=(()=>{class r{static#e=this.\u0275fac=function(e){return new(e||r)};static#t=this.\u0275mod=t.$C({type:r});static#i=this.\u0275inj=f.G2t({imports:[y.iI.forChild(j),y.iI]})}return r})(),k=(()=>{class r{static#e=this.\u0275fac=function(e){return new(e||r)};static#t=this.\u0275mod=t.$C({type:r});static#i=this.\u0275inj=f.G2t({imports:[x.MD,p.YN,p.X1,m.bv,R]})}return r})()}}]);