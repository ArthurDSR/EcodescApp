"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1039],{1039:(T,u,n)=>{n.r(u),n.d(u,{AddEcopontoPageModule:()=>F});var h=n(2200),s=n(4341),c=n(9420),m=n(8132),E=n(467);class g{constructor(){this.id=0,this.nome="",this.coordenadas="",this.descricao=""}}var l=n(8244),M=n(839),o=n(3664),p=n(8728),f=n(4192),w=n(5032),b=n(9330),x=n(3665);const k=()=>({standalone:!0});function y(a,v){if(1&a){const t=o.RV6();o.j41(0,"div",20),o.bIt("click",function(){const i=p.eBV(t).$implicit,r=o.XpG(2);return p.Njj(r.selecionarLocalizacao(i))})("mouseenter",function(){const i=p.eBV(t).index,r=o.XpG(2);return p.Njj(r.selectedIndex=i)}),o.j41(1,"div",21),o.EFF(2),o.k0s(),o.j41(3,"div",22),o.EFF(4),o.k0s()()}if(2&a){const t=v.$implicit;o.R7$(2),o.JRh(t.displayName||t.display_name),o.R7$(2),o.Lme("",t.type||t.class," - ",t.addressType||t.class," ")}}function _(a,v){if(1&a&&(o.j41(0,"div",17)(1,"div",18),o.DNE(2,y,5,3,"div",19),o.k0s()()),2&a){const t=o.XpG();o.AVh("visible",t.searchResults.length>0&&t.showDropdown),o.R7$(2),o.Y8G("ngForOf",t.searchResults)}}const P=[{path:"",component:(()=>{class a{constructor(t,e,i,r,d,z,I){this.router=t,this.formBuilder=e,this.toastController=i,this.activatedRoute=r,this.navController=d,this.http=z,this.ecopontoService=I,this.searchQuery="",this.searchResults=[],this.showMap=!0,this.showDropdown=!1,this.selectedIndex=-1,this.api_url="http://localhost:8080/api/v1",this.latitude=0,this.longitude=0,this.ecoponto=new g,this.formGroup=this.formBuilder.group({nome:[this.ecoponto.nome,s.k0.compose([s.k0.required])],descricao:[this.ecoponto.descricao,s.k0.compose([s.k0.required])]})}ngOnInit(){this.registrarLocalizacao().then(()=>{this.inicializarMapa()}).catch(e=>{console.error("Erro ao obter localiza\xe7\xe3o:",e),this.latitude=-23.5505,this.longitude=-46.6333,this.inicializarMapa()});let t=parseFloat(this.activatedRoute.snapshot.params.id);isNaN(t)||this.ecopontoService.buscarPorId(t).subscribe({next:e=>{this.ecoponto=e,this.formGroup.patchValue({nome:this.ecoponto.nome,descricao:this.ecoponto.descricao})},error:e=>{console.error(e),this.exibirMensagem("Erro ao carregar o ecoponto.")}})}ngAfterViewInit(){}inicializarMapa(){this.iconesLeaflet(),setTimeout(()=>{this.criarMapa()},500)}registrarLocalizacao(){return new Promise((t,e)=>{M.L.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4,maximumAge:0}).then(i=>{this.latitude=i.coords.latitude,this.longitude=i.coords.longitude,console.log("Localiza\xe7\xe3o obtida:",this.latitude,this.longitude),t()}).catch(i=>{console.error("Erro ao obter localiza\xe7\xe3o:",i),e(i)})})}criarMapa(){document.getElementById("map"),this.map&&this.map.remove();try{this.map=l.map("map").setView([this.latitude,this.longitude],13),l.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"\xa9 OpenStreetMap contributors"}).addTo(this.map);const e=l.divIcon({className:"user-location-marker",html:'<div style="background-color: #007bff; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.3);"></div>',iconSize:[20,20],iconAnchor:[10,10]});l.marker([this.latitude,this.longitude],{icon:e}).bindPopup("Sua localiza\xe7\xe3o atual").addTo(this.map),setTimeout(()=>{this.ecoponto&&this.ecoponto.coordenadas&&this.aplicarCoordenadasNoMapa(),this.map&&this.map.invalidateSize()},200)}catch(e){console.error("Erro ao criar mapa:",e),this.exibirMensagem("Erro ao criar o mapa.")}}iconesLeaflet(){delete l.Icon.Default.prototype._getIconUrl,l.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"})}aplicarCoordenadasNoMapa(){if(this.ecoponto&&this.ecoponto.coordenadas&&this.map){const t=this.ecoponto.coordenadas.split(",");if(2===t.length){const e=parseFloat(t[0].trim()),i=parseFloat(t[1].trim());!isNaN(e)&&!isNaN(i)&&this.updateMapLocation(e,i)}}}onSearchFocus(){this.showDropdown=!0}onSearchBlur(){setTimeout(()=>{this.showDropdown=!1},200)}onSearchInput(t){const e=t.detail.value;if(this.searchQuery=e,this.selectedIndex=-1,this.searchTimeout&&clearTimeout(this.searchTimeout),e.length<3)return this.searchResults=[],void(this.showDropdown=!1);this.showDropdown=!0,this.searchTimeout=setTimeout(()=>{this.searchLocation(e)},500)}searchLocation(t){this.http.get(`${this.api_url}/ecoponto/search-location`,{params:{query:t,limit:"5",email:"andreyzacariascarvalho@gmail.com"}}).subscribe({next:r=>{this.searchResults=r,this.showDropdown=r.length>0},error:r=>{console.error("Erro ao buscar localiza\xe7\xe3o:",r),this.searchResults=[],this.showDropdown=!1,this.exibirMensagem("Erro ao buscar localiza\xe7\xe3o. Verifique sua conex\xe3o.")}})}selecionarLocalizacao(t){this.formGroup.patchValue({descricao:t.displayName||t.display_name}),this.ecoponto.coordenadas=`${t.lat}, ${t.lon}`,this.searchResults=[],this.showDropdown=!1,this.searchQuery=t.displayName||t.display_name,this.updateMapLocation(parseFloat(t.lat),parseFloat(t.lon))}updateMapLocation(t,e){if(this.map){this.map.invalidateSize(),this.map.setView([t,e],15),this.marker&&(this.map.removeLayer(this.marker),this.marker=void 0);try{this.marker=l.marker([t,e]).addTo(this.map)}catch{this.marker=l.marker([t,e]).addTo(this.map)}setTimeout(()=>{this.map&&this.map.invalidateSize()},100)}else console.error("Mapa n\xe3o est\xe1 dispon\xedvel para atualiza\xe7\xe3o")}salvarEcoponto(){if(this.formGroup.invalid)return void this.exibirMensagem("Por favor, preencha todos os campos obrigat\xf3rios.");if(!this.ecoponto.coordenadas)return void this.exibirMensagem("Por favor, selecione uma localiza\xe7\xe3o no mapa.");let t=new g;t.nome=this.formGroup.value.nome,t.coordenadas=this.ecoponto.coordenadas,t.descricao=this.formGroup.value.descricao,this.ecoponto.id?(t.id=this.ecoponto.id,this.ecopontoService.atualizar(t).subscribe({next:()=>{this.exibirMensagem("Ecoponto salvo com sucesso!!!")},error:e=>{console.error(e),this.exibirMensagem("Erro ao salvar o ecoponto.")}})):this.ecopontoService.salvar(t).subscribe({next:()=>{this.exibirMensagem("Ecoponto salvo com sucesso!!!")},error:e=>{console.error(e),this.exibirMensagem("Erro ao salvar o ecoponto.")}}),this.router.navigate(["/ecoponto"],{replaceUrl:!0})}exibirMensagem(t){var e=this;return(0,E.A)(function*(){(yield e.toastController.create({message:t,duration:1500})).present()})()}limpar(){this.formGroup.reset(),this.searchQuery="",this.searchResults=[],this.showDropdown=!1,this.selectedIndex=-1,this.ecoponto.coordenadas="",this.marker&&this.map&&(this.map.removeLayer(this.marker),this.marker=void 0),this.map&&this.map.setView([this.latitude,this.longitude],10),this.formGroup.patchValue({nome:"",descricao:""})}voltar(){this.router.navigate(["/ecoponto"],{replaceUrl:!0})}static#o=this.\u0275fac=function(e){return new(e||a)(o.rXU(f.Ix),o.rXU(s.ok),o.rXU(c.K_),o.rXU(f.nX),o.rXU(w.q9),o.rXU(b.Qq),o.rXU(x.p))};static#t=this.\u0275cmp=o.VBU({type:a,selectors:[["app-add-ecoponto"]],standalone:!1,decls:30,vars:5,consts:[["color","transparent"],[1,"ion-padding"],[1,"formulario",3,"formGroup"],["expand","block",1,"botao",3,"click"],["name","refresh-outline","slot","start"],[1,"form-item"],["position","stacked"],["type","text","placeholder","Digite o nome do ecoponto","formControlName","nome",1,"form-input"],[1,"search-container"],["type","text","placeholder","Digite o endere\xe7o ou local",1,"form-input",3,"ngModelChange","ionInput","ionFocus","ionBlur","ngModel","ngModelOptions"],["class","search-dropdown",3,"visible",4,"ngIf"],[1,"map-container"],[1,"map-label"],["id","map",1,"map"],["placeholder","Descri\xe7\xe3o ou endere\xe7o do ecoponto","formControlName","descricao","rows","3",1,"form-input"],[1,"form-buttons"],["name","save-outline","slot","start"],[1,"search-dropdown"],[1,"dropdown-content"],["class","dropdown-item",3,"click","mouseenter",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"click","mouseenter"],[1,"item-title"],[1,"item-subtitle"]],template:function(e,i){1&e&&(o.nrm(0,"ion-toolbar",0),o.j41(1,"ion-content",1)(2,"form",2)(3,"ion-row")(4,"ion-col")(5,"ion-button",3),o.bIt("click",function(){return i.limpar()}),o.nrm(6,"ion-icon",4),o.EFF(7," Limpar "),o.k0s()()(),o.j41(8,"ion-item",5)(9,"ion-label",6),o.EFF(10,"Nome do Ecoponto"),o.k0s(),o.nrm(11,"ion-input",7),o.k0s(),o.j41(12,"div",8)(13,"ion-item",5)(14,"ion-label",6),o.EFF(15,"Pesquisar Localiza\xe7\xe3o"),o.k0s(),o.j41(16,"ion-input",9),o.mxI("ngModelChange",function(d){return o.DH7(i.searchQuery,d)||(i.searchQuery=d),d}),o.bIt("ionInput",function(d){return i.onSearchInput(d)})("ionFocus",function(){return i.onSearchFocus()})("ionBlur",function(){return i.onSearchBlur()}),o.k0s()(),o.DNE(17,_,3,3,"div",10),o.k0s(),o.j41(18,"div",11)(19,"ion-label",12),o.EFF(20,"Localiza\xe7\xe3o no Mapa"),o.k0s(),o.nrm(21,"div",13),o.k0s(),o.j41(22,"ion-item",5)(23,"ion-label",6),o.EFF(24,"Descri\xe7\xe3o/Endere\xe7o"),o.k0s(),o.nrm(25,"ion-textarea",14),o.k0s(),o.j41(26,"div",15)(27,"ion-button",3),o.bIt("click",function(){return i.salvarEcoponto()}),o.nrm(28,"ion-icon",16),o.EFF(29," Salvar Ecoponto "),o.k0s()()()()),2&e&&(o.R7$(2),o.Y8G("formGroup",i.formGroup),o.R7$(14),o.R50("ngModel",i.searchQuery),o.Y8G("ngModelOptions",o.lJ4(4,k)),o.R7$(),o.Y8G("ngIf",i.searchResults.length>0))},dependencies:[h.Sq,h.bT,s.qT,s.BC,s.cb,s.vS,c.Jm,c.hU,c.W9,c.iq,c.$w,c.uz,c.he,c.ln,c.nc,c.ai,c.Gw,s.j4,s.JD],styles:["[_nghost-%COMP%]     .leaflet-popup-content-wrapper{visibility:hidden;border-radius:8px}[_nghost-%COMP%]     .leaflet-popup-content{visibility:hidden;font-family:Outfit,sans-serif;color:#003554}[_nghost-%COMP%]     .leaflet-control-attribution{font-size:10px;background:#fffc}[_nghost-%COMP%]     .leaflet-container{cursor:default!important}.form-item[_ngcontent-%COMP%]{color:#003554;margin-bottom:20px;--background: rgba(140, 190, 227, .15);--border-radius: 15px;--border-style: none;--inner-border-width: 0;border-radius:15px;padding:10px}.location-input[_ngcontent-%COMP%]{--color: #666}.search-container[_ngcontent-%COMP%]{position:relative;z-index:1000}.search-dropdown[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;right:0;background:#fff;border-radius:12px;box-shadow:0 8px 24px #00000026;border:1px solid rgba(140,190,227,.3);z-index:1001;max-height:300px;overflow-y:auto;opacity:0;transform:translateY(-10px);transition:all .3s ease;pointer-events:none}.search-dropdown.visible[_ngcontent-%COMP%]{opacity:1;transform:translateY(0);pointer-events:all}.dropdown-content[_ngcontent-%COMP%]{padding:8px 0}.dropdown-item[_ngcontent-%COMP%]{padding:12px 16px;cursor:pointer;border-bottom:1px solid rgba(140,190,227,.1);transition:background-color .2s ease}.dropdown-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.dropdown-item[_ngcontent-%COMP%]:hover, .dropdown-item.highlighted[_ngcontent-%COMP%]{background-color:#8cbee31a}.dropdown-item[_ngcontent-%COMP%]:active{background-color:#8cbee333}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#8cbee31a;border-radius:3px}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#8cbee380;border-radius:3px}.search-dropdown[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#8cbee3b3}"]})}return a})()}];let C=(()=>{class a{static#o=this.\u0275fac=function(e){return new(e||a)};static#t=this.\u0275mod=o.$C({type:a});static#e=this.\u0275inj=p.G2t({imports:[m.iI.forChild(P),m.iI]})}return a})(),F=(()=>{class a{static#o=this.\u0275fac=function(e){return new(e||a)};static#t=this.\u0275mod=o.$C({type:a});static#e=this.\u0275inj=p.G2t({imports:[h.MD,s.YN,c.bv,C,s.X1,b.q1]})}return a})()}}]);